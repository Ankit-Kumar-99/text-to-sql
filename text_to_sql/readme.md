# Marketing Lens NL → SQL Generator (BigQuery)

## Overview

This project converts **natural language marketing questions** into
**validated Google BigQuery SQL queries** using **Google Gemini**.

It is designed for the Marketing Lens application, where users can ask:

- “How many clicks did campaign X get?”
- “What was the revenue generated by country?”
- “How many users clicked and purchased in the same session?”

The system outputs a clean, safe SQL query that can be executed directly in BigQuery.

---

## Key Features

✅ Natural Language → SQL conversion  
✅ BigQuery Standard SQL output  
✅ Production-style validation guardrails  
✅ Prevents unsafe SQL (DROP/DELETE/UPDATE blocked)  
✅ Prevents GA4 raw schema hallucinations (`UNNEST`, `event_params`)  
✅ Two-step generation:

1. SQL Generation  
2. SQL Review + Fix

✅ Auto-regeneration if invalid SQL is produced

---

## Overall Architecture

```text
User Question (Terminal Input)
        ↓
Step 1: SQL Generation (Gemini)
        ↓
Step 2: SQL Review + Correction (Gemini)
        ↓
Schema + Safety Validation Guardrails
        ↓
Auto-Retry (if forbidden GA4 nested schema appears)
        ↓
Final Validated SQL Output


## Setup

### 1. Create Virtual Environment
```bash
python -m venv .venv
source .venv/bin/activate
